<form>
    <div class="schedule-group">
        <div class="form-group">
            <label for="dayOfTheWeek">ìš”ì¼</label>
            <select class="form-control" name="dayOfTheWeek">
                <option value="1">ì›”ìš”ì¼</option>
                <option value="2">í™”ìš”ì¼</option>
                <option value="3">ìˆ˜ìš”ì¼</option>
                <option value="4">ëª©ìš”ì¼</option>
                <option value="5">ê¸ˆìš”ì¼</option>
                <option value="6">í† ìš”ì¼</option>
                <option value="7">ì¼ìš”ì¼</option>
            </select>
        </div>
        <div class="form-group">
            <label for="startTime">ì‹œì‘ ì‹œê°„</label>
            <input type="time" class="form-control" name="startTime" step="1800" />
        </div>
        <div class="form-group">
            <label for="endTime">ì¢…ë£Œ ì‹œê°„</label>
            <input type="time" class="form-control" name="endTime" step="1800" />
        </div>
        <div class="form-group">
            <label for="startDate">ì‹œì‘ ë‚ ì§œ</label>
            <input type="date" class="form-control" name="startDate" />
        </div>
        <div class="form-group">
            <label for="endDate">ì¢…ë£Œ ë‚ ì§œ</label>
            <input type="date" class="form-control" name="endDate" />
        </div>
    </div>
    <button type="button" class="btn btn-primary add-schedule">ì¼ì • ì¶”ê°€</button>
    <button type="submit" class="btn btn-primary">ì œì¶œ</button>
</form>

<script>
    $(function () {
        $('.add-schedule').click(function () {
            let scheduleGroup = $('.schedule-group').first().clone();
            scheduleGroup.find('select, input').val('');
            $('.schedule-group').last().after(scheduleGroup);
        });
    });

    const form = document.querySelector('form');

    $(document).ready(function () {
        $('form').submit(function (event) {
            // ê¸°ë³¸ ì œì¶œ ì´ë²¤íŠ¸ ë§‰ê¸°
            event.preventDefault();
            const urlParams = new URLSearchParams(window.location.search);
            const doctorId = urlParams.get('doctorId');

            var data = [];

            $('.schedule-group').each(function () {
                var dayOfTheWeek = $(this).find('select[name=dayOfTheWeek]').val();
                var startTime = $(this).find('input[name=startTime]').val();
                var endTime = $(this).find('input[name=endTime]').val();
                var startDate = $(this).find('input[name=startDate]').val();
                var endDate = $(this).find('input[name=endDate]').val();
                var status = $(this).find('input[name=status]:checked').val();

                data.push({
                    dayOfTheWeek: dayOfTheWeek,
                    startTime: startTime,
                    endTime: endTime,
                    startDate: startDate,
                    endDate: endDate,
                    status: status,
                });
            });

            // JSON í˜•ì‹ìœ¼ë¡œ ë°ì´í„° êµ¬ì„±
            var Data = {
                doctorId: doctorId,
                workingTimes: data,
            };

            // AJAX ìš”ì²­ ë³´ë‚´ê¸°
            $.ajax({
                type: 'POST',
                url: '/api/hospitals/register/doctor/workingtime',
                data: JSON.stringify(Data),
                dataType: 'json',
                contentType: 'application/json; charset=utf-8',
                success: function (result) {
                    swal('ğŸ˜Š ì§„ë£Œì‹œê°„ë“±ë¡ ì„±ê³µ!', 'ì„±ê³µì ìœ¼ë¡œ ì œì¶œ ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    // ì„±ê³µì ìœ¼ë¡œ ì œì¶œëœ ê²½ìš°, ì…ë ¥ëœ ë°ì´í„° ì´ˆê¸°í™”
                    $('form')[0].reset();
                    window.location.href = '/hospital';
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    swal(
                        'ğŸ˜­ ì§„ë£Œì‹œê°„ë“±ë¡ ì‹¤íŒ¨',
                        'ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì˜¤ë¥˜ ìƒíƒœ ì½”ë“œ: ' + jqXHR.status,
                        'error'
                    );
                },
            });
        });
    });
</script>
