<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>ÌöåÏõêÍ∞ÄÏûÖ</title>
    </head>

    <body>
        <div id="main">
            <div class="inner">
                <div style="margin-top: 100px">
                    <form action="" method="post">
                        <table style="width: 700px; margin: 0 auto">
                            <tr>
                                <td>ÏÑ±Ìï® :</td>
                                <td>
                                    <input type="text" id="name" name="name" placeholder="Name" />
                                </td>
                            </tr>
                            <tr>
                                <td>Ïù¥Î©îÏùº :</td>
                                <td>
                                    <input
                                        type="email"
                                        id="email"
                                        name="email"
                                        placeholder="email@naver.com"
                                    />
                                </td>
                            </tr>
                            <tr>
                                <td>ÎπÑÎ∞ÄÎ≤àÌò∏ :</td>
                                <td>
                                    <input
                                        type="password"
                                        id="password"
                                        name="password"
                                        placeholder="6Í∏ÄÏûê Ïù¥ÏÉÅ, ÌäπÏàòÎ¨∏ÏûêÍ∞Ä Ìè¨Ìï®ÎêòÏñ¥Ïïº Ìï©ÎãàÎã§."
                                    />
                                </td>
                            </tr>
                            <tr>
                                <td>ÎπÑÎ∞ÄÎ≤àÌò∏ÌôïÏù∏ :</td>
                                <td>
                                    <input
                                        type="password"
                                        id="confirm"
                                        name="confirm"
                                        oninput="check_pw()"
                                    />&nbsp;<span id="check"></span>
                                </td>
                            </tr>
                            <tr>
                                <td>Ï†ÑÌôîÎ≤àÌò∏ :</td>
                                <td>
                                    <input
                                        type="tel"
                                        id="phone"
                                        name="phone"
                                        placeholder="010-0000-0000 ÌòïÏãùÏúºÎ°ú Ï†ÅÏñ¥Ï£ºÏÑ∏Ïöî"
                                        pattern="[0-9]{3}-[0-9]{4}-[0-9]{4}"
                                        required
                                    />
                                </td>
                            </tr>
                            <tr>
                                <td>Ï£ºÎØºÎì±Î°ùÎ≤àÌò∏ :</td>
                                <td>
                                    <input
                                        type="password"
                                        id="idNumber"
                                        name="idNumber"
                                        placeholder="13ÏûêÎ¶¨ - Î•º Ìè¨Ìï®Ìï¥Ï£ºÏÑ∏Ïöî"
                                        pattern="[0-9]{6}-[0-9]{7}"
                                        required
                                    />
                                </td>
                            </tr>
                        </table>
                        <div style="text-align: center; margin-top: 40px">
                            <button style="width: 150px" class="button signup__submit" id="signup">
                                ÌöåÏõêÍ∞ÄÏûÖ
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script>
            function check_pw() {
                var pw = document.getElementById('password').value;
                var SC = ['!', '@', '#', '$', '%', '*', '^', '&', '(', ')', ':'];
                var check_SC = 0;

                if (pw.length < 6 || pw.length > 16) {
                    swal({
                        title: 'üòì Ï£ÑÏÜ°Ìï©ÎãàÎã§.',
                        text: 'ÎπÑÎ∞ÄÎ≤àÌò∏Îäî 6Í∏ÄÏûê Ïù¥ÏÉÅ, 16Í∏ÄÏûê Ïù¥ÌïòÎßå Ïù¥Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§.',
                        icon: 'warning',
                    }).then(() => {
                        document.getElementById('password').value = '';
                    });
                }
                for (var i = 0; i < SC.length; i++) {
                    if (pw.indexOf(SC[i]) != -1) {
                        check_SC = 1;
                    }
                }
                if (check_SC == 0) {
                    swal({
                        title: 'üòì Ï£ÑÏÜ°Ìï©ÎãàÎã§.',
                        text: '!,@,#,$,%,*,^,&,(,),: Ïùò ÌäπÏàòÎ¨∏ÏûêÍ∞Ä Îì§Ïñ¥Í∞Ä ÏûàÏßÄ ÏïäÏäµÎãàÎã§.',
                        icon: 'warning',
                    }).then(() => {
                        document.getElementById('password').value = '';
                    });
                }
                if (
                    document.getElementById('password').value != '' &&
                    document.getElementById('confirm').value != ''
                ) {
                    if (
                        document.getElementById('password').value ==
                        document.getElementById('confirm').value
                    ) {
                        document.getElementById('check').innerHTML = 'ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌï©ÎãàÎã§.';
                        document.getElementById('check').style.color = 'blue';
                    } else {
                        document.getElementById('check').innerHTML =
                            'ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏäµÎãàÎã§.';
                        document.getElementById('check').style.color = 'red';
                    }
                }
            }

            document.getElementById('signup').addEventListener('click', (event) => {
                event.preventDefault();

                const data = {
                    name: document.getElementById('name').value,
                    loginId: document.getElementById('email').value,
                    password: document.getElementById('password').value,
                    confirm: document.getElementById('confirm').value,
                    phone: document.getElementById('phone').value,
                    idNumber: document.getElementById('idNumber').value,
                };
                // console.log(data);

                fetch('/api/users/signup/customer', {
                    credentials: 'include',
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                })
                    // .then(res => res.json())
                    .then((response) => {
                        //response= data
                        console.log(response);
                        if (response.status === 412) {
                            throw new Error('Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî Ïù¥Î©îÏùº ÏûÖÎãàÎã§.');
                        }
                        if (response.status === 422) {
                            throw new Error('ÏûòÎ™ªÎêú ÌòïÏãùÏûÖÎãàÎã§.');
                        }
                        swal({
                            title: 'üòä ÌöåÏõêÍ∞ÄÏûÖ ÏÑ±Í≥µ!',
                            text: 'Î™®ÎëêÏùò Î≥ëÏõêÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§.',
                            icon: 'success',
                        }).then(() => {
                            location.href = '/';
                        });
                    })
                    .catch((err) => {
                        swal({
                            title: 'üò≠ ÌöåÏõêÍ∞ÄÏûÖ Ïã§Ìå®',
                            text: err.message,
                            icon: 'error',
                        }).then(() => {
                            window.location.reload();
                        });
                    });
            });
        </script>
    </body>
</html>
