<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>íšŒì›ê°€ì…</title>
    </head>

    <body>
        <div id="main">
            <div class="inner">
                <div style="margin-top: 100px">
                    <form action="" method="post">
                        <table style="width: 700px; margin: 0 auto">
                            <tr>
                                <td>ì„±í•¨ :</td>
                                <td>
                                    <input type="text" id="name" name="name" placeholder="Name" />
                                </td>
                            </tr>
                            <tr>
                                <td>ì´ë©”ì¼ :</td>
                                <td>
                                    <input
                                        type="email"
                                        id="email"
                                        name="email"
                                        placeholder="email@naver.com"
                                    />
                                </td>
                            </tr>
                            <tr>
                                <td>ë¹„ë°€ë²ˆí˜¸ :</td>
                                <td>
                                    <input
                                        type="password"
                                        id="password"
                                        name="password"
                                        placeholder="6ê¸€ì ì´ìƒ, íŠ¹ìˆ˜ë¬¸ìê°€ í¬í•¨ë˜ì–´ì•¼ í•©ë‹ˆë‹¤."
                                    />
                                </td>
                            </tr>
                            <tr>
                                <td>ë¹„ë°€ë²ˆí˜¸í™•ì¸ :</td>
                                <td>
                                    <input
                                        type="password"
                                        id="confirm"
                                        name="confirm"
                                        oninput="check_pw()"
                                    />&nbsp;<span id="check"></span>
                                </td>
                            </tr>
                            <tr>
                                <td>ì „í™”ë²ˆí˜¸ :</td>
                                <td>
                                    <input
                                        type="tel"
                                        id="phone"
                                        name="phone"
                                        placeholder="010-0000-0000 í˜•ì‹ìœ¼ë¡œ ì ì–´ì£¼ì„¸ìš”"
                                        pattern="[0-9]{3}-[0-9]{4}-[0-9]{4}"
                                        required
                                    />
                                </td>
                            </tr>
                            <tr>
                                <td>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ :</td>
                                <td>
                                    <input
                                        type="password"
                                        id="idNumber"
                                        name="idNumber"
                                        placeholder="13ìë¦¬ - ë¥¼ í¬í•¨í•´ì£¼ì„¸ìš”"
                                        pattern="[0-9]{6}-[0-9]{7}"
                                        required
                                    />
                                </td>
                            </tr>
                        </table>
                        <div style="text-align: center; margin-top: 40px">
                            <button style="width: 150px" class="button signup__submit" id="signup">
                                íšŒì›ê°€ì…
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script>
            function check_pw() {
                var pw = document.getElementById('password').value;
                var SC = ['!', '@', '#', '$', '%', '*', '^', '&', '(', ')', ':'];
                var check_SC = 0;

                if (pw.length < 6 || pw.length > 16) {
                    swal(
                        'ğŸ˜“ ì£„ì†¡í•©ë‹ˆë‹¤.',
                        'ë¹„ë°€ë²ˆí˜¸ëŠ” 6ê¸€ì ì´ìƒ, 16ê¸€ì ì´í•˜ë§Œ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.',
                        'warning'
                    );
                    document.getElementById('password').value = '';
                }
                for (var i = 0; i < SC.length; i++) {
                    if (pw.indexOf(SC[i]) != -1) {
                        check_SC = 1;
                    }
                }
                if (check_SC == 0) {
                    swal(
                        'ğŸ˜“ ì£„ì†¡í•©ë‹ˆë‹¤.',
                        '!,@,#,$,%,*,^,&,(,),: ì˜ íŠ¹ìˆ˜ë¬¸ìê°€ ë“¤ì–´ê°€ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.',
                        'warning'
                    );
                    document.getElementById('password').value = '';
                }
                if (
                    document.getElementById('password').value != '' &&
                    document.getElementById('confirm').value != ''
                ) {
                    if (
                        document.getElementById('password').value ==
                        document.getElementById('confirm').value
                    ) {
                        document.getElementById('check').innerHTML = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•©ë‹ˆë‹¤.';
                        document.getElementById('check').style.color = 'blue';
                    } else {
                        document.getElementById('check').innerHTML =
                            'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                        document.getElementById('check').style.color = 'red';
                    }
                }
            }

            document.getElementById('signup').addEventListener('click', (event) => {
                event.preventDefault();

                const data = {
                    name: document.getElementById('name').value,
                    loginId: document.getElementById('email').value,
                    password: document.getElementById('password').value,
                    confirm: document.getElementById('confirm').value,
                    phone: document.getElementById('phone').value,
                    idNumber: document.getElementById('idNumber').value,
                };
                // console.log(data);

                fetch('/api/users/signup/customer', {
                    credentials: 'include',
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                })
                    // .then(res => res.json())
                    .then((response) => {
                        //response= data
                        console.log(response);
                        if (response.status === 412) {
                            throw new Error('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ ì…ë‹ˆë‹¤.');
                        }
                        if (response.status === 422) {
                            throw new Error('ì˜ëª»ëœ í˜•ì‹ì…ë‹ˆë‹¤.');
                        }

                        swal('ğŸ˜Š íšŒì›ê°€ì… ì„±ê³µ!', 'ëª¨ë‘ì˜ ë³‘ì›ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.', 'success');
                        location.href = '/';
                    })
                    .catch((err) => {
                        swal('ğŸ˜­ íšŒì›ê°€ì… ì‹¤íŒ¨', err.message, 'error');
                        window.location.reload();
                    });
            });
        </script>
    </body>
</html>
