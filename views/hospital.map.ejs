<html>

<head>
    <title>ëª¨ë‘ì˜ ë³‘ì›</title>
</head>

<body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" href="/css/map.css" />
    <div class="header">
        <input type="checkbox" name="departmentCheckbox" id="departmentCheckbox" />
        <label for="departmentCheckbox" title="ì¹´í…Œê³ ë¦¬ë¡œ ê²€ìƒ‰í•˜ê¸°">
            <span></span>
            <span></span>
            <span></span>
        </label>
        <div class="boxwrap">
            <div id="departmentwrap">
                <div class="division">
                    <div>
                        ê°ì—¼ë‚´ê³¼<input type="checkbox" name="department" value="ê°ì—¼ë‚´ê³¼" />
                    </div>
                    <div>
                        ë‚´ë¶„ë¹„ë‚´ê³¼<input type="checkbox" name="department" value="ë‚´ë¶„ë¹„ë‚´ê³¼" />
                    </div>
                    <div>
                        ë¥˜ë§ˆí‹°ìŠ¤ë‚´ê³¼<input type="checkbox" name="department" value="ë‚´ë¶„ë¹„ë‚´ê³¼" />
                    </div>
                    <div>
                        ìˆœí™˜ê¸°ë‚´ê³¼<input type="checkbox" name="department" value="ìˆœí™˜ê¸°ë‚´ê³¼" />
                    </div>
                    <div>
                        ì‹ ì¥ë‚´ê³¼<input type="checkbox" name="department" value="ì‹ ì¥ë‚´ê³¼" />
                    </div>
                    <div>
                        ì•Œë ˆë¥´ê¸°ë‚´ê³¼<input type="checkbox" name="department" value="ì•Œë ˆë¥´ê¸°ë‚´ê³¼" />
                    </div>
                    <div>
                        í˜ˆì•¡ì¢…ì–‘ë‚´ê³¼<input type="checkbox" name="department" value="í˜ˆì•¡ì¢…ì–‘ë‚´ê³¼" />
                    </div>
                    <div>
                        í˜¸í¡ê¸°ë‚´ê³¼<input type="checkbox" name="department" value="í˜¸í¡ê¸°ë‚´ê³¼" />
                    </div>
                </div>
                <div class="division">
                    <div>
                        ëŒ€ì¥í•­ë¬¸<input type="checkbox" name="department" value="ëŒ€ì¥í•­ë¬¸" />
                    </div>
                    <div>
                        ì„±í˜•ì™¸ê³¼<input type="checkbox" name="department" value="ì„±í˜•ì™¸ê³¼" />
                    </div>
                    <div>
                        ì‹ ê²½ì™¸ê³¼<input type="checkbox" name="department" value="ì‹ ê²½ì™¸ê³¼" />
                    </div>
                    <div>ì™¸ê³¼<input type="checkbox" name="department" value="ì™¸ê³¼" /></div>
                    <div>
                        ì •í˜•ì™¸ê³¼<input type="checkbox" name="department" value="ì •í˜•ì™¸ê³¼" />
                    </div>
                    <div>
                        í‰ë¶€ì™¸ê³¼<input type="checkbox" name="department" value="í‰ë¶€ì™¸ê³¼" />
                    </div>
                </div>
                <div class="division">
                    <div>
                        ì‚°ë¶€ì¸ê³¼<input type="checkbox" name="department" value="ì‚°ë¶€ì¸ê³¼" />
                    </div>
                    <div>í”¼ë¶€ê³¼<input type="checkbox" name="department" value="í”¼ë¶€ê³¼" /></div>
                    <div>
                        ë¹„ë‡¨ê¸°ê³¼<input type="checkbox" name="department" value="ë¹„ë‡¨ê¸°ê³¼" />
                    </div>
                    <div>ì•ˆê³¼<input type="checkbox" name="department" value="ì•ˆê³¼" /></div>
                    <div>
                        ì´ë¹„ì¸í›„ê³¼<input type="checkbox" name="department" value="ì´ë¹„ì¸í›„ê³¼" />
                    </div>
                    <div>ì •ì‹ ê³¼<input type="checkbox" name="department" value="ì •ì‹ ê³¼" /></div>
                    <div>
                        ë§ˆì·¨í†µì¦ì˜í•™ê³¼<input type="checkbox" name="department" value="ë§ˆì·¨í†µì¦ì˜í•™ê³¼" />
                    </div>
                    <div>
                        ê°€ì •ì˜í•™ê³¼<input type="checkbox" name="department" value="ê°€ì •ì˜í•™ê³¼" />
                    </div>
                    <div>
                        ì‘ê¸‰ì˜í•™ê³¼<input type="checkbox" name="department" value="ì‘ê¸‰ì˜í•™ê³¼" />
                    </div>
                    <div>
                        ì¬í™œì˜í•™ê³¼<input type="checkbox" name="department" value="ì¬í™œì˜í•™ê³¼" />
                    </div>
                    <div>
                        ì˜ìƒì˜í•™ê³¼<input type="checkbox" name="department" value="ì˜ìƒì˜í•™ê³¼" />
                    </div>
                    <div>
                        ë°©ì‚¬ì„ ì¢…ì–‘í•™ê³¼<input type="checkbox" name="department" value="ë°©ì‚¬ì„ ì¢…ì–‘í•™ê³¼" />
                    </div>
                    <div>
                        í•µì˜í•™ê³¼<input type="checkbox" name="department" value="í•µì˜í•™ê³¼" />
                    </div>
                    <div>
                        ì§„ë‹¨ê²€ì‚¬ì˜í•™ê³¼<input type="checkbox" name="department" value="ì§„ë‹¨ê²€ì‚¬ì˜í•™ê³¼" />
                    </div>
                    <div>ë³‘ë¦¬ê³¼<input type="checkbox" name="department" value="ë³‘ë¦¬ê³¼" /></div>
                    <div>
                        ì˜ê³µí•™ê³¼<input type="checkbox" name="department" value="ì˜ê³µí•™ê³¼" />
                    </div>
                    <div>í•œë°©ê³¼<input type="checkbox" name="department" value="í•œë°©ê³¼" /></div>
                </div>
            </div>
            <button id="departmentBtn" style="display: block">ì ìš©í•˜ê¸°</button>
            <button id="resetBtn" style="display: block">ì´ˆê¸°í™”</button>
            <div style="width:380px;margin-left: 10px;margin-top: 30px;margin-bottom: 10px;">
                !ì‚¬ìš©ë°©ë²•!
                ì°¾ê³  ì‹¶ì€ ì§„ë£Œê³¼ë¥¼ ì„ íƒí•œë‹¤! ì ìš©í•˜ê¸°ë¥¼ ëˆ„ë¥´ë©´ í™”ë©´ì— ìˆëŠ” ì§€ë„ ê¸°ì¤€ìœ¼ë¡œ ì§„ë£Œê³¼ë¥¼ ê°€ì§„ ë³‘ì›ì´ ë‚˜ì™€ìš”! ë³µìˆ˜ ì„ íƒë„ ê°€ëŠ¥í•©ë‹ˆë‹¤!<br><br>
                ex) "ë¹„ë‡¨ê¸°ê³¼ì™€ í”¼ë¶€ê³¼ë¥¼ ê°™ì´ í•˜ëŠ” ê³³ì„ ì°¾ì•„ì„œ ê°€ê³  ì‹¶ì–´!!"<br>
                ë¹„ë‡¨ê¸°ê³¼ í´ë¦­ + í”¼ë¶€ê³¼ í´ë¦­ í•˜ì‹  ë’¤ ì ìš©í•˜ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë¹„ë‡¨ê¸°ê³¼ í˜¹ì€ í”¼ë¶€ê³¼ë¥¼ ì§„ë£Œí•˜ëŠ” ë³‘ì›ì´ ë‚˜ì˜µë‹ˆë‹¤.
            </div>
        </div>
        <a href="/" id="homeIcon" title="í™ˆ">ëª¨ë‘ì˜ ë³‘ì›</a>
        <input type="checkbox" name="" id="menuIcon" />
        <label for="menuIcon" title="ë³‘ì› ë¦¬ìŠ¤íŠ¸">
            <span></span>
            <span></span>
            <span></span>
        </label>
        <div class="sidebar">
            <div style="margin-top: 5vh"></div>
            <nav id="list">
                ê·¼ì²˜ì— ë³‘ì›ì´ ì—†ìŠµë‹ˆë‹¤!
                <ul></ul>
            </nav>
        </div>
    </div>
    <div id="map" style="width: 100%; height: 95vh"></div>
    <div>
        <button id="listBtn" type="menu"></button>
    </div>
</body>

</html>
<script type="text/javascript"
    src="//dapi.kakao.com/v2/maps/sdk.js?appkey=cfe684de49325af43a940eb82545abfc&libraries=services"></script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=cfe684de49325af43a940eb82545abfc"></script>
<script type="text/javascript"
    src="//dapi.kakao.com/v2/maps/sdk.js?appkey=cfe684de49325af43a940eb82545abfc&libraries=services,clusterer,drawing"></script>
<script src="/js/token.js"></script>
<script>
    window.onload = function () {
        load();
    };
    var globalMarker = [];

    let ae1;
    let cc;

    let ff;
    let gg;

    let a;
    let listEvent;
    let def;
    // ë™ì˜
    function successCallback(position) {
        swal({
            title: 'ğŸ˜ ë„ìš°ë¯¸ ì¶œëª°!',
            text: 'í˜„ì¬ ë³‘ì› ì •ë³´ëŠ” ì„œìš¸ ë‚´ì— ìˆëŠ” ë³‘ì›ë§Œ ì¡´ì¬í•©ë‹ˆë‹¤.\nìœ„ì¹˜ ì•¡ì„¸ìŠ¤ë¥¼ ì°¨ë‹¨í•˜ì‹œë©´ ë³´ë‹¤ ì‰½ê²Œ ì„œë¹„ìŠ¤ë¥¼ ì²´í—˜í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
            icon: 'info',
            button: 'í™•ì¸',
        }).then(() => {
            return;
        });
        // í˜„ì¬ ì¢Œí‘œ ì¤‘ì‹¬ì¢Œí‘œ
        // position.coords.latitude,position.coords.longitude	 37.486868162882, 127.08303697984
        var mapContainer = document.getElementById('map'); // ì§€ë„ë¥¼ í‘œì‹œí•  div

        mapOption = {
            center: new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
            level: 5, // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
        };

        var map = new kakao.maps.Map(mapContainer, mapOption); // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤

        map.setMaxLevel(8);

        var geocoder = new kakao.maps.services.Geocoder();

        let data = getData(map);

        listEvent = listBtnClickEvent(map);

        a = fetchData(map, geocoder);

        de(map, geocoder);

        document.getElementById('departmentBtn').addEventListener('click', (event) => {
            event.preventDefault();
            let arr = [];
            const department = document.getElementsByName('department');
            for (let i = 0; i < department.length; i++) {
                if (department[i].checked == true) {
                    arr.push(department[i]);
                }
            }

            if (arr.length > 0) {
                kakao.maps.event.removeListener(map, 'dragend', cc);
                kakao.maps.event.removeListener(map, 'zoom_changed', ae1);
            }
        });

        document.getElementById('resetBtn').addEventListener('click', (event) => {
            event.preventDefault();
            const department = document.getElementsByName('department');
            for (let i = 0; i < department.length; i++) {
                department[i].checked = false;
            }

            kakao.maps.event.removeListener(map, 'zoom_changed', ff);
            kakao.maps.event.removeListener(map, 'dragend', gg);

            let data = getData(map);
            fetch(`/api/hospitals/around/info`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then((response) => response.json())
                .then((data) => {

                    if (!data.hospitals[0]) {
                        return document.getElementById('list').innerHTML = `ê·¼ì²˜ì— ë³‘ì›ì´ ì—†ìŠµë‹ˆë‹¤!`;
                    }
                    document.getElementById('list').innerHTML = ``;
                    for (let i = 0; i < data.hospitals.length; i++) {
                        const a = `
                  <div onclick="location.href='/hospitals/${data.hospitals[i].hospitalId}'" class="listBox">
                <img src="${data.hospitals[i].hospitalImage}" alt="${data.hospitals[i].hospitalImage}">
                <div class="hospitalInfo">
                <span style="position:static">${data.hospitals[i].name}</span>
                <span style="position:static">${data.hospitals[i].address}</span>
                <span style="position:static">${data.hospitals[i].phone}</span>
                <span style="position:static">${data.hospitals[i].departments}</span>
                </div>
                </div>
                `;

                        const li = document.createElement('li');
                        li.innerHTML = a;
                        document.getElementById('list').appendChild(li);
                    }

                    const a = document.getElementById('listBtn');
                    a.innerText = `ê·¼ì²˜ ${data.hospitals.length}ê°œì˜ ë³‘ì›`;
                    for (let i = 0; i < data.hospitals.length; i++) {
                        geocoder.addressSearch(
                            data.hospitals[i].address,
                            function (result, status) {
                                // ì •ìƒì ìœ¼ë¡œ ê²€ìƒ‰ì´ ì™„ë£Œëìœ¼ë©´
                                if (status === kakao.maps.services.Status.OK) {
                                    var coords = new kakao.maps.LatLng(
                                        result[0].y,
                                        result[0].x
                                    );

                                    // ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ì€ ìœ„ì¹˜ë¥¼ ë§ˆì»¤ë¡œ í‘œì‹œí•©ë‹ˆë‹¤
                                    var marker = new kakao.maps.Marker({
                                        map: map,
                                        position: coords,
                                    });

                                    marker.id = data.hospitals[i].hospitalId;
                                    // ë§ˆì»¤ì— í´ë¦­ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
                                    markerClick(marker);
                                    globalMarker.push(marker);
                                }
                            }
                        );
                    }
                });

            kakao.maps.event.addListener(map, 'zoom_changed', ae1);

            kakao.maps.event.addListener(map, 'dragend', cc);
        });
    }

    // ë™ì˜ X
    function errorCallback(error) {
        // í˜„ì¬ ì¢Œí‘œ ì¤‘ì‹¬ì¢Œí‘œ
        // position.coords.latitude,position.coords.longitude	 37.486868162882, 127.08303697984
        var mapContainer = document.getElementById('map'); // ì§€ë„ë¥¼ í‘œì‹œí•  div

        mapOption = {
            center: new kakao.maps.LatLng(37.486868162882, 127.08303697984), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
            level: 5, // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
        };

        var map = new kakao.maps.Map(mapContainer, mapOption); // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤

        map.setMaxLevel(8);

        var geocoder = new kakao.maps.services.Geocoder();

        let data = getData(map);

        listEvent = listBtnClickEvent(map);

        a = fetchData(map, geocoder);

        de(map, geocoder);

        document.getElementById('departmentBtn').addEventListener('click', (event) => {
            event.preventDefault();
            let arr = [];
            const department = document.getElementsByName('department');
            for (let i = 0; i < department.length; i++) {
                if (department[i].checked == true) {
                    arr.push(department[i]);
                }
            }

            if (arr.length > 0) {
                kakao.maps.event.removeListener(map, 'dragend', cc);
                kakao.maps.event.removeListener(map, 'zoom_changed', ae1);
            }
        });

        document.getElementById('resetBtn').addEventListener('click', (event) => {
            event.preventDefault();
            const department = document.getElementsByName('department');
            for (let i = 0; i < department.length; i++) {
                department[i].checked = false;
            }

            kakao.maps.event.removeListener(map, 'zoom_changed', ff);
            kakao.maps.event.removeListener(map, 'dragend', gg);

            let data = getData(map);
            fetch(`/api/hospitals/around/info`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then((response) => response.json())
                .then((data) => {

                    if (!data.hospitals[0]) {
                        return document.getElementById('list').innerHTML = `ê·¼ì²˜ì— ë³‘ì›ì´ ì—†ìŠµë‹ˆë‹¤!`;
                    }
                    document.getElementById('list').innerHTML = ``;
                    for (let i = 0; i < data.hospitals.length; i++) {
                        const a = `
                  <div onclick="location.href='/hospitals/${data.hospitals[i].hospitalId}'" class="listBox">
                <img src="${data.hospitals[i].hospitalImage}" alt="${data.hospitals[i].hospitalImage}">
                <div class="hospitalInfo">
                <span style="position:static">${data.hospitals[i].name}</span>
                <span style="position:static">${data.hospitals[i].address}</span>
                <span style="position:static">${data.hospitals[i].phone}</span>
                <span style="position:static">${data.hospitals[i].departments}</span>
                </div>
                </div>
                `;

                        const li = document.createElement('li');
                        li.innerHTML = a;
                        document.getElementById('list').appendChild(li);
                    }

                    const a = document.getElementById('listBtn');
                    a.innerText = `ê·¼ì²˜ ${data.hospitals.length}ê°œì˜ ë³‘ì›`;
                    for (let i = 0; i < data.hospitals.length; i++) {
                        geocoder.addressSearch(
                            data.hospitals[i].address,
                            function (result, status) {
                                // ì •ìƒì ìœ¼ë¡œ ê²€ìƒ‰ì´ ì™„ë£Œëìœ¼ë©´
                                if (status === kakao.maps.services.Status.OK) {
                                    var coords = new kakao.maps.LatLng(
                                        result[0].y,
                                        result[0].x
                                    );

                                    // ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ì€ ìœ„ì¹˜ë¥¼ ë§ˆì»¤ë¡œ í‘œì‹œí•©ë‹ˆë‹¤
                                    var marker = new kakao.maps.Marker({
                                        map: map,
                                        position: coords,
                                    });

                                    marker.id = data.hospitals[i].hospitalId;
                                    // ë§ˆì»¤ì— í´ë¦­ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
                                    markerClick(marker);
                                    globalMarker.push(marker);
                                }
                            }
                        );
                    }
                });

            kakao.maps.event.addListener(map, 'zoom_changed', ae1);

            kakao.maps.event.addListener(map, 'dragend', cc);
        });
    }

    function load() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
        } else {
            swal('ğŸ˜“ ì£„ì†¡í•©ë‹ˆë‹¤.', 'ì§€ë¦¬ì  ìœ„ì¹˜ê°€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'warning');
        }
    }

    function getData(map) {
        var bounds = map.getBounds();

        // ì˜ì—­ì˜ ë‚¨ì„œìª½ ì¢Œí‘œë¥¼ ì–»ì–´ì˜µë‹ˆë‹¤
        var swLatLng = bounds.getSouthWest();

        // ì˜ì—­ì˜ ë¶ë™ìª½ ì¢Œí‘œë¥¼ ì–»ì–´ì˜µë‹ˆë‹¤
        var neLatLng = bounds.getNorthEast();

        const data = {
            rightLatitude: neLatLng.getLat(),
            rightLongitude: neLatLng.getLng(),
            leftLatitude: swLatLng.getLat(),
            leftLongitude: swLatLng.getLng(),
        };

        return data;
    }

    function clickBtn() {
        // ì²´í¬í•œ ë°ì´í„°ë¥¼ ë‹´ì„ ë°°ì—´ ì„ ì–¸
        const arr = [];
        // Nameì´ Colorì¸ ì†ì„± ì·¨ë“
        const department = document.getElementsByName('department');
        // ì·¨ë“í•œ ì†ì„± ë§Œí¼ ë£¨í”„
        for (let i = 0; i < department.length; i++) {
            // ì†ì„±ì¤‘ì— ì²´í¬ ëœ í•­ëª©ì´ ìˆì„ ê²½ìš°
            if (department[i].checked == true) {
                arr.push(department[i].value);
            }
        }
        return arr.join(',');
    }

    function listBtnClickEvent(map) {
        document.getElementById('listBtn').addEventListener('click', (event) => {
            event.preventDefault();

            document.getElementById('menuIcon').checked = true;

            const data = getData(map);

            fetch(`/api/hospitals/around/info`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then((response) => response.json())
                .then((data) => {
                    if (!data.hospitals[0]) {
                        return document.getElementById('list').innerHTML = `ê·¼ì²˜ì— ë³‘ì›ì´ ì—†ìŠµë‹ˆë‹¤!`;
                    }
                    document.getElementById('list').innerHTML = ``;
                    for (let i = 0; i < data.hospitals.length; i++) {
                        const a = `
              <div onclick="location.href='/hospitals/${data.hospitals[i].hospitalId}'" class="listBox">
                <img src="${data.hospitals[i].hospitalImage}" alt="${data.hospitals[i].hospitalImage}">
                <div class="hospitalInfo">
                <span style="position:static">${data.hospitals[i].name}</span>
                <span style="position:static">${data.hospitals[i].address}</span>
                <span style="position:static">${data.hospitals[i].phone}</span>
                <span style="position:static">${data.hospitals[i].departments}</span>
                </div>
                <div>
              `;

                        const li = document.createElement('li');
                        li.innerHTML = a;
                        document.getElementById('list').appendChild(li);
                    }
                });
        });
    }

    function fetchData(map, geocoder) {
        const data = getData(map);
        globalMarker.map((marker) => marker.setMap(null));
        fetch(`/api/hospitals/around`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
            .then((response) => response.json())
            .then((data) => {
                const a = document.getElementById('listBtn');
                a.innerText = `ê·¼ì²˜ ${data.hospitals.length}ê°œì˜ ë³‘ì›`;

                ae1 = function () {
                    globalMarker.map((marker) => marker.setMap(null));

                    const data = getData(map);

                    fetch(`/api/hospitals/around/info`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data),
                    })
                        .then((response) => response.json())
                        .then((data) => {

                            if (!data.hospitals[0]) {
                                const a = document.getElementById('listBtn');
                        a.innerText = `ê·¼ì²˜ ${data.hospitals.length}ê°œì˜ ë³‘ì›`;
                                return document.getElementById('list').innerHTML = `ê·¼ì²˜ì— ë³‘ì›ì´ ì—†ìŠµë‹ˆë‹¤!`;
                            }
                            document.getElementById('list').innerHTML = ``;
                            for (let i = 0; i < data.hospitals.length; i++) {
                                const a = `
                  <div onclick="location.href='/hospitals/${data.hospitals[i].hospitalId}'" class="listBox">
                <img src="${data.hospitals[i].hospitalImage}" alt="${data.hospitals[i].hospitalImage}">
                <div class="hospitalInfo">
                <span style="position:static">${data.hospitals[i].name}</span>
                <span style="position:static">${data.hospitals[i].address}</span>
                <span style="position:static">${data.hospitals[i].phone}</span>
                <span style="position:static">${data.hospitals[i].departments}</span>
                </div>
                </div>
                `;

                                const li = document.createElement('li');
                                li.innerHTML = a;
                                document.getElementById('list').appendChild(li);
                            }

                            const a = document.getElementById('listBtn');
                            a.innerText = `ê·¼ì²˜ ${data.hospitals.length}ê°œì˜ ë³‘ì›`;
                            for (let i = 0; i < data.hospitals.length; i++) {
                                geocoder.addressSearch(
                                    data.hospitals[i].address,
                                    function (result, status) {
                                        // ì •ìƒì ìœ¼ë¡œ ê²€ìƒ‰ì´ ì™„ë£Œëìœ¼ë©´
                                        if (status === kakao.maps.services.Status.OK) {
                                            var coords = new kakao.maps.LatLng(
                                                result[0].y,
                                                result[0].x
                                            );

                                            // ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ì€ ìœ„ì¹˜ë¥¼ ë§ˆì»¤ë¡œ í‘œì‹œí•©ë‹ˆë‹¤
                                            var marker = new kakao.maps.Marker({
                                                map: map,
                                                position: coords,
                                            });

                                            marker.id = data.hospitals[i].hospitalId;
                                            // ë§ˆì»¤ì— í´ë¦­ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
                                            markerClick(marker);
                                            globalMarker.push(marker);
                                        }
                                    }
                                );
                            }
                        });
                };

                cc = function () {
                    globalMarker.map((marker) => marker.setMap(null));

                    const data = getData(map);

                    fetch(`/api/hospitals/around/info`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data),
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            if (!data.hospitals[0]) {
                                const a = document.getElementById('listBtn');
                        a.innerText = `ê·¼ì²˜ ${data.hospitals.length}ê°œì˜ ë³‘ì›`;
                                return document.getElementById('list').innerHTML = `ê·¼ì²˜ì— ë³‘ì›ì´ ì—†ìŠµë‹ˆë‹¤!`;
                            }
                            document.getElementById('list').innerHTML = ``;
                            for (let i = 0; i < data.hospitals.length; i++) {
                                const a = `
                    <div onclick="location.href='/hospitals/${data.hospitals[i].hospitalId}'" class="listBox">
                    <img src="${data.hospitals[i].hospitalImage}" alt="${data.hospitals[i].hospitalImage}">
                    <div class="hospitalInfo">
                    <span style="position:static">${data.hospitals[i].name}</span>
                    <span style="position:static">${data.hospitals[i].address}</span>
                    <span style="position:static">${data.hospitals[i].phone}</span>
                    <span style="position:static">${data.hospitals[i].departments}</span>
                    </div>
                    </div>
                  `;

                                const li = document.createElement('li');
                                li.innerHTML = a;
                                document.getElementById('list').appendChild(li);
                            }

                            const a = document.getElementById('listBtn');
                            a.innerText = `ê·¼ì²˜ ${data.hospitals.length}ê°œì˜ ë³‘ì›`;
                            for (let i = 0; i < data.hospitals.length; i++) {
                                geocoder.addressSearch(
                                    data.hospitals[i].address,
                                    function (result, status) {
                                        // ì •ìƒì ìœ¼ë¡œ ê²€ìƒ‰ì´ ì™„ë£Œëìœ¼ë©´
                                        if (status === kakao.maps.services.Status.OK) {
                                            var coords = new kakao.maps.LatLng(
                                                result[0].y,
                                                result[0].x
                                            );

                                            // ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ì€ ìœ„ì¹˜ë¥¼ ë§ˆì»¤ë¡œ í‘œì‹œí•©ë‹ˆë‹¤
                                            var marker = new kakao.maps.Marker({
                                                map: map,
                                                position: coords,
                                            });

                                            marker.id = data.hospitals[i].hospitalId;
                                            // ë§ˆì»¤ì— í´ë¦­ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
                                            markerClick(marker);
                                            globalMarker.push(marker);
                                        }
                                    }
                                );
                            }
                        });
                };

                if (!data.hospitals[0]) {
                    kakao.maps.event.addListener(map, 'zoom_changed', ae1);

                    kakao.maps.event.addListener(map, 'dragend', cc);
                } else {
                    const coordinate = getData(map);

                    fetch(`/api/hospitals/around/info`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(coordinate),
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            document.getElementById('list').innerHTML = ``;
                            for (let i = 0; i < data.hospitals.length; i++) {
                                const a = `
                  <div onclick="location.href='/hospitals/${data.hospitals[i].hospitalId}'" class="listBox">
                <img src="${data.hospitals[i].hospitalImage}" alt="${data.hospitals[i].hospitalImage}">
                <div class="hospitalInfo">
                <span style="position:static">${data.hospitals[i].name}</span>
                <span style="position:static">${data.hospitals[i].address}</span>
                <span style="position:static">${data.hospitals[i].phone}</span>
                <span style="position:static">${data.hospitals[i].departments}</span>
                </div>
                </div>
                `;

                                const li = document.createElement('li');
                                li.innerHTML = a;
                                document.getElementById('list').appendChild(li);
                            }
                        });

                    for (let i = 0; i < data.hospitals.length; i++) {
                        geocoder.addressSearch(
                            data.hospitals[i].address,
                            function (result, status) {
                                // ì •ìƒì ìœ¼ë¡œ ê²€ìƒ‰ì´ ì™„ë£Œëìœ¼ë©´
                                if (status === kakao.maps.services.Status.OK) {
                                    var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                                    // ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ì€ ìœ„ì¹˜ë¥¼ ë§ˆì»¤ë¡œ í‘œì‹œí•©ë‹ˆë‹¤
                                    var marker = new kakao.maps.Marker({
                                        map: map,
                                        position: coords,
                                    });

                                    marker.id = data.hospitals[i].hospitalId;
                                    // ë§ˆì»¤ì— í´ë¦­ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
                                    markerClick(marker);

                                    globalMarker.push(marker);
                                }

                                kakao.maps.event.addListener(map, 'zoom_changed', ae1);

                                kakao.maps.event.addListener(map, 'dragend', cc);
                            }
                        );
                    }
                }
            });
    }

    function markerClick(marker) {
        kakao.maps.event.addListener(marker, 'click', function () {
            // ë§ˆì»¤ ìœ„ì— ì¸í¬ìœˆë„ìš°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤
            const id = marker.id;
            document.getElementById('menuIcon').checked = true;
            fetch(`/api/hospitals/info/${id}`)
                .then((response) => response.json())
                .then((data) => {
                    document.getElementById('list').innerHTML = ``;

                    const image = `<img src="${data.hospitalImage}" alt="${data.hospitalImage}" class="hospitalImage">`;
                    const imagewrap = document.createElement('div');
                    imagewrap.innerHTML = image;
                    document.getElementById('list').appendChild(imagewrap);
                    const a = `
                                        
            <div class="info">
                <p>${data.hospitalName}</p>
                <p>${data.hospitalphone}</p>
                <p>${data.hospitalAddress}</p>
                </div>
                                        `;
                    const li = document.createElement('li');
                    li.innerHTML = a;
                    document.getElementById('list').appendChild(li);

                    for (let i = 0; i < data.doctors.length; i++) {
                        const b = `                                  <img src="${data.doctors[i].doctorImage}" alt="${data.doctors[i].doctor}" class="doctorImg">
              <div class="info">
              <span>${data.doctors[i].doctor}</span>
                    <span>${data.doctors[i].department}</span>
                    </div>`;
                        const doctorLi = document.createElement('li');
                        doctorLi.innerHTML = b;
                        document.getElementById('list').appendChild(doctorLi);
                    }

                    const c = `
          <button onclick="location.href='/hospitals/${data.hospitalId}'" id="pageMoveButton">ì´ë™í•˜ê¸°</button>
          `;
                    const button = document.createElement('li');
                    button.innerHTML = c;
                    document.getElementById('list').appendChild(button);
                });
        });
    }

    function listBtnClickEventDepartment(map) {
        document.getElementById('listBtn').addEventListener('click', (event) => {
            event.preventDefault();

            const data = getData(map);
            const department = clickBtn();
            data.department = department;

            fetch(`/api/categories/search`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then((response) => response.json())
                .then((data) => {
                    if (!data[0]) {
                        return document.getElementById('list').innerHTML = `ê·¼ì²˜ì— ë³‘ì›ì´ ì—†ìŠµë‹ˆë‹¤!`;
                    }
                    document.getElementById('list').innerHTML = ``;
                    for (let i = 0; i < data.length; i++) {
                        const a = `
              <div onclick="location.href='/hospitals/${data[i].hospitalId}'" class="listBox">
                <img src="${data[i].hospitalImage}" alt="${data[i].hospitalImage}">
                <div class="hospitalInfo">
                <span style="position:static">${data[i].name}</span>
                <span style="position:static">${data[i].address}</span>
                <span style="position:static">${data[i].phone}</span>
                <span style="position:static">${data[i].departments}</span>
                </div>
                </div>
              `;

                        const li = document.createElement('li');
                        li.innerHTML = a;
                        document.getElementById('list').appendChild(li);
                    }
                });
        });
    }

    function de(map, geocoder) {
        // localhost:3000/api/categories/search
        document.getElementById('departmentBtn').addEventListener('click', (event) => {
            let arr = [];
            const departmentCheckbox = document.getElementsByName('department');
            for (let i = 0; i < departmentCheckbox.length; i++) {
                if (departmentCheckbox[i].checked == true) {
                    arr.push(departmentCheckbox[i]);
                }
            }

            if (arr.length == 0) return;

            globalMarker.map((marker) => marker.setMap(null));
            const department = clickBtn();

            document.getElementById('departmentBtn').removeEventListener('click', a);
            document.getElementById('departmentBtn').removeEventListener('click', listEvent);
            event.preventDefault();
            const data = getData(map);
            data.department = department;
            globalMarker.map((marker) => marker.setMap(null));

            listBtnClickEventDepartment(map);

            fetch(`/api/categories/search`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
                .then((response) => response.json())
                .then((data) => {
                    if (!data[0]) {
                        const a = document.getElementById('listBtn');
                        a.innerText = `ê·¼ì²˜ ${data.length}ê°œì˜ ë³‘ì›`;
                        return document.getElementById('list').innerHTML = `ê·¼ì²˜ì— ë³‘ì›ì´ ì—†ìŠµë‹ˆë‹¤!`;
                    }
                    document.getElementById('list').innerHTML = ``;
                    const a = document.getElementById('listBtn');
                    a.innerText = `ê·¼ì²˜ ${data.length}ê°œì˜ ë³‘ì›`;

                    ff = function () {
                        globalMarker.map((marker) => marker.setMap(null));

                        const data = getData(map);
                        const department = clickBtn();
                        data.department = department;

                        fetch(`/api/categories/search`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(data),
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                if (!data[0]) {
                                    const a = document.getElementById('listBtn');
                                    a.innerText = `ê·¼ì²˜ ${data.length}ê°œì˜ ë³‘ì›`;
                                    return document.getElementById('list').innerHTML = `ê·¼ì²˜ì— ë³‘ì›ì´ ì—†ìŠµë‹ˆë‹¤!`;
                                }
                                document.getElementById('list').innerHTML = ``;
                                const a = document.getElementById('listBtn');
                                a.innerText = `ê·¼ì²˜ ${data.length}ê°œì˜ ë³‘ì›`;
                                for (let i = 0; i < data.length; i++) {
                                    const a = `
                                    <div onclick="location.href='/hospitals/${data[i].hospitalId}'" class="listBox">
                        <img src="${data[i].hospitalImage}" alt="${data[i].hospitalImage}">
                        <div class="hospitalInfo">
                        <span style="position:static">${data[i].name}</span>
                        <span style="position:static">${data[i].address}</span>
                        <span style="position:static">${data[i].phone}</span>
                        <span style="position:static">${data[i].departments}</span>
                        </div>
                        </div>
                     `;

                                    const li = document.createElement('li');
                                    li.innerHTML = a;
                                    document.getElementById('list').appendChild(li);

                                    geocoder.addressSearch(
                                        data[i].address,
                                        function (result, status) {
                                            // ì •ìƒì ìœ¼ë¡œ ê²€ìƒ‰ì´ ì™„ë£Œëìœ¼ë©´
                                            if (status === kakao.maps.services.Status.OK) {
                                                var coords = new kakao.maps.LatLng(
                                                    result[0].y,
                                                    result[0].x
                                                );

                                                // ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ì€ ìœ„ì¹˜ë¥¼ ë§ˆì»¤ë¡œ í‘œì‹œí•©ë‹ˆë‹¤
                                                var marker = new kakao.maps.Marker({
                                                    map: map,
                                                    position: coords,
                                                });

                                                marker.id = data[i].hospitalId;
                                                // ë§ˆì»¤ì— í´ë¦­ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
                                                markerClick(marker);
                                                globalMarker.push(marker);
                                            }
                                        }
                                    );
                                }
                            });
                    };

                    gg = function () {
                        globalMarker.map((marker) => marker.setMap(null));

                        const data = getData(map);
                        const department = clickBtn();
                        data.department = department;

                        fetch(`/api/categories/search`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(data),
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                if (!data[0]) {
                                    const a = document.getElementById('listBtn');
                        a.innerText = `ê·¼ì²˜ ${data.length}ê°œì˜ ë³‘ì›`;
                                    return document.getElementById('list').innerHTML = `ê·¼ì²˜ì— ë³‘ì›ì´ ì—†ìŠµë‹ˆë‹¤!`;
                                }
                                document.getElementById('list').innerHTML = ``;
                                const a = document.getElementById('listBtn');
                                a.innerText = `ê·¼ì²˜ ${data.length}ê°œì˜ ë³‘ì›`;
                                for (let i = 0; i < data.length; i++) {
                                    const a = `
                    <div onclick="location.href='/hospitals/${data[i].hospitalId}'" class="listBox">
                        <img src="${data[i].hospitalImage}" alt="${data[i].hospitalImage}">
                        <div class="hospitalInfo">
                            <span style="position:static">${data[i].name}</span>
                        <span style="position:static">${data[i].address}</span>
                        <span style="position:static">${data[i].phone}</span>
                        <span style="position:static">${data[i].departments}</span>
                        </div>
                        </div>
                      `;

                                    const li = document.createElement('li');
                                    li.innerHTML = a;
                                    document.getElementById('list').appendChild(li);
                                    geocoder.addressSearch(
                                        data[i].address,
                                        function (result, status) {
                                            // ì •ìƒì ìœ¼ë¡œ ê²€ìƒ‰ì´ ì™„ë£Œëìœ¼ë©´
                                            if (status === kakao.maps.services.Status.OK) {
                                                var coords = new kakao.maps.LatLng(
                                                    result[0].y,
                                                    result[0].x
                                                );

                                                // ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ì€ ìœ„ì¹˜ë¥¼ ë§ˆì»¤ë¡œ í‘œì‹œí•©ë‹ˆë‹¤
                                                var marker = new kakao.maps.Marker({
                                                    map: map,
                                                    position: coords,
                                                });

                                                marker.id = data[i].hospitalId;
                                                // ë§ˆì»¤ì— í´ë¦­ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
                                                markerClick(marker);
                                                globalMarker.push(marker);
                                            }
                                        }
                                    );
                                }
                            });
                    };
                    if (!data[0]) {
                        kakao.maps.event.addListener(map, 'zoom_changed', ff);

                        kakao.maps.event.addListener(map, 'dragend', gg);
                    } else {
                        globalMarker.map((marker) => marker.setMap(null));
                        for (let i = 0; i < data.length; i++) {
                            const a = `
                <div onclick="location.href='/hospitals/${data[i].hospitalId}'" class="listBox">
                <img src="${data[i].hospitalImage}" alt="${data[i].hospitalImage}">
                <div class="hospitalInfo">
                    <span style="position:static">${data[i].name}</span>
                        <span style="position:static">${data[i].address}</span>
                        <span style="position:static">${data[i].phone}</span>
                        <span style="position:static">${data[i].departments}</span>
                </div>
                </div>
              `;

                            const li = document.createElement('li');
                            li.innerHTML = a;
                            document.getElementById('list').appendChild(li);
                            geocoder.addressSearch(data[i].address, function (result, status) {
                                // ì •ìƒì ìœ¼ë¡œ ê²€ìƒ‰ì´ ì™„ë£Œëìœ¼ë©´
                                if (status === kakao.maps.services.Status.OK) {
                                    var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                                    // ê²°ê³¼ê°’ìœ¼ë¡œ ë°›ì€ ìœ„ì¹˜ë¥¼ ë§ˆì»¤ë¡œ í‘œì‹œí•©ë‹ˆë‹¤
                                    var marker = new kakao.maps.Marker({
                                        map: map,
                                        position: coords,
                                    });

                                    marker.id = data[i].hospitalId;
                                    // ë§ˆì»¤ì— í´ë¦­ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
                                    markerClick(marker);
                                    globalMarker.push(marker);
                                }
                            });
                        }
                        kakao.maps.event.addListener(map, 'zoom_changed', ff);

                        kakao.maps.event.addListener(map, 'dragend', gg);
                    }
                });
        });
    }
</script>